import{a1 as c,T as r,O as n}from"./app-13978987.js";import{f as i}from"./fabric-1ff51d4a.js";let t=null;const g=c({id:"designStore",state:()=>({textSizes:["60","40","30","20","16"],shapes:["octangle","pentagon","square"],tabLists:[{label:"settings",icon:"bx-cog"},{label:"text",icon:"bx-text"},{label:"image",icon:"bx-image-alt"},{label:"shapes",icon:"bxs-shapes"},{label:"placeholder",icon:"bx-flag"}],fontLists:["Classica","Butler","Roboto","Open Sans","Lato","Oswald","Raleway","Montserrat"],selectedObject:null,activeObject:null,saveCanvasJson:null,tab:"settings",form:r({canvas:null,placeholder:null,title:"",status:"inactive"}),placeholders:{image:!1,logo:!1,slogan:!1},textStyles:{fontSize:20,fontFamily:"Arial",fill:"white",fontWeight:"normal",fontStyle:"normal",underline:!1,textAlign:"center",fill:"white",backgroundColor:"transparent"},shapeStyles:{fill:"",stroke:""},objectStyles:{},canvasStyles:{preserveObjectStacking:!0,backgroundColor:"transparent",width:500,height:500},imageStyles:{cornerRadius:0},objectOpacity:100,canvasLoading:!1}),actions:{setTab(e){this.selectedObject=null,this.tab=e},objectSelected(){const e=t.getActiveObject();this.selectedObject=e.type,console.log(e),e.type!=="activeSelection"&&(e.isType("i-text")?(this.textStyles.fontSize=e.fontSize,this.textStyles.fontFamily=e.fontFamily,this.textStyles.fontWeight=e.fontWeight,this.textStyles.fontStyle=e.fontStyle||"normal",this.textStyles.fill=e.fill,this.textStyles.backgroundColor=e.backgroundColor||"transparent"):e.isType("group")?this.objectStyles=e.getObjects():["rect","path","polygon","circle"].includes(e.type)&&(this.selectedObject="shape",this.shapeStyles.fill=e.fill,this.shapeStyles.stroke=e.stroke),this.tab=null)},objectDeselected(){this.selectedObject=null,this.tab||(this.tab="settings")},initializeCanvas(e,s=null){if(t=new i.fabric.Canvas(e,this.canvasStyles),t.on("selection:created",this.objectSelected),t.on("selection:updated",this.objectSelected),t.on("selection:cleared",this.objectDeselected),s){var l=new Image;l.src=s,console.log(l.width,l.height),l.onload=function(){t.setBackgroundImage(s,t.renderAll.bind(t),{scaleX:t.width/l.width,scaleY:t.height/l.height,backgroundImageStretch:!0})}}},loadCanvasFromJSON(e,s){let l=e.objects;for(let a of l)if(a.id==="placeholderImage"&&(this.placeholders.image=!0),a.id==="placeholderLogo"&&(this.placeholders.logo=!0),a.id==="slogan"&&(this.placeholders.slogan=!0),a.type==="i-text"&&a.left<51){let o;a.left<50&&(o=Math.abs(a.left+50)),a.left<0&&(o=Math.abs(a.left+100)),a.left+=o}t.loadFromJSON(JSON.stringify(e),function(){t.renderAll()}),this.form.title=(s==null?void 0:s.title)||(s==null?void 0:s.category_id),this.form.status=s.status},changeSelectedTextStyle(){t.getActiveObject().set({...this.textStyles}),t.requestRenderAll()},changeShapeStyle(){t.getActiveObject().set({...this.shapeStyles}),t.renderAll()},changeGroupObjectStyle(){this.canvasLoading=!0;const e=t.getActiveObject();e.getObjects().forEach((s,l)=>{s.set(this.objectStyles[l])}),e.dirty=!0,setTimeout(()=>t.requestRenderAll(),0),this.canvasLoading=!1},changeCanvasStyle(){t.backgroundColor=this.canvasStyles.backgroundColor,t.renderAll()},changeImageStyle(){if(this.imageStyles.cornerRadius>100)return;const e=t.getActiveObject(),s=(l,a)=>new i.fabric.Rect({width:l.width,height:l.height,rx:a/l.scaleX,ry:a/l.scaleY,left:-l.width/2,top:-l.height/2});e.clipPath=s(e,this.imageStyles.cornerRadius),e.dirty=!0,setTimeout(()=>t.requestRenderAll(),500)},setText(e){const s=new i.fabric.IText("Text",{left:10,top:10,fontSize:e,fontFamily:"Arial",fill:"#ffffff",fontWeight:"normal",underline:!1,textAlign:"center",textBackgroundColor:"transparent"});t.add(s),t.renderAll()},setShape(e){this.canvasLoading=!0,i.fabric.loadSVGFromURL(e,(s,l)=>{let a=i.fabric.util.groupSVGElements(s,l);a.set({left:10,top:10,subTargetCheck:!0}),t.add(a),t.renderAll(),this.canvasLoading=!1})},bringToFront(){t.bringToFront(t.getActiveObject()),t.renderAll()},sendToBack(){t.sendToBack(t.getActiveObject()),t.renderAll()},uploadImage(e){const s=new FileReader;s.onload=function(l){i.fabric.Image.fromURL(l.target.result,function(a){a.scale(.2).set({left:200,top:100}),t.add(a)})},s.readAsDataURL(e.target.files[0])},addPlaceholderSlogan(){if(this.placeholders.slogan)return;const e=new i.fabric.IText("Your text here",{left:10,top:10,fontSize:20,fontFamily:"Arial",fill:"white",fontWeight:"bold",id:"slogan"});t.add(e),t.renderAll(),this.placeholders.slogan=!0},addPlaceholderFile(e,s,l){this.placeholders[l]||(i.fabric.Image.fromURL(e,function(a){a.scale(.2).set({left:100,top:100,id:s}),t.add(a)}),t.renderAll(),this.placeholders[l]=!0)},submit(e,s=null){this.form.canvas=JSON.stringify(t.toJSON(["id"])),this.form.placeholder=t.toDataURL(),e&&(this.form.status=e);const l=s?route("admin.design.update",s):route("admin.design.store"),a=s?"patch":"post";this.form[a](l,{onSuccess:()=>{this.$reset()}})},submitImage(e,s="copy"){const l={_method:"PATCH",image:t.toDataURL({width:500,height:500}),saveType:s};n.post(route("user.assets.update",e),l,{onSuccess:()=>{this.$reset()}})},submitLogo(e,s=null){let l=t.toDataURL();e&&(this.form.status=e);const a={preview:l,category_id:this.form.title,status:this.form.status,canvas:JSON.stringify(t.toJSON(["id"]))},o=s?route("admin.brand-logos.update",s):route("admin.brand-logos.store");n[s?"patch":"post"](o,a,{onSuccess:()=>{this.$reset()}})},remove(){const e=t.getActiveObjects();e.length?confirm("Do you want to delete the selected items?")&&e.forEach(function(s){t.remove(s)}):t.remove(t.getActiveObject()),t.renderAll()},changeObjectOpacity(){const e=t.getActiveObject();e.opacity=this.objectOpacity/100,t.renderAll()}},getters:{getTabState:e=>s=>e.tab==s,getSelectedObjectState:e=>s=>e.selectedObject==s}});export{g as u};

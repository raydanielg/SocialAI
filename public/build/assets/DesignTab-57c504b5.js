import{m as u,l as G,W as K,x as Q,c as f,d as _,I as X,u as i,b as t,t as x,a as Y,j as P,a7 as z,v as M,i as ee,F as N,r as te,e as se,o as d,a4 as R,n as oe,q as S,a5 as ae}from"./app-13978987.js";import{_ as ne}from"./HollowDotsSpinner-aede4138.js";import{u as le}from"./publishStore-a6d0eb83.js";import{f as w}from"./fabric-1ff51d4a.js";import{u as ie}from"./designStore-f93d210d.js";import{s as re}from"./multiselect-4ccf8c7b.js";const ce={class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50"},de={class:"max-h-[700px] max-w-[900px] rounded-md bg-secondary-100 p-6 dark:bg-secondary-800"},me={class:"mb-4 flex items-center justify-between"},ge=t("h6",null,"Modify design",-1),fe=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"34",height:"34",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"m12 13.4l-2.9 2.9q-.275.275-.7.275t-.7-.275q-.275-.275-.275-.7t.275-.7l2.9-2.9l-2.9-2.875q-.275-.275-.275-.7t.275-.7q.275-.275.7-.275t.7.275l2.9 2.9l2.875-2.9q.275-.275.7-.275t.7.275q.3.3.3.713t-.3.687L13.375 12l2.9 2.9q.275.275.275.7t-.275.7q-.3.3-.713.3t-.687-.3L12 13.4Z"})],-1),pe=[fe],ue={class:"grid grid-cols-2 place-content-center gap-5 md:grid-cols-12"},be={class:"col-span-full space-y-6 rounded-md bg-secondary-200 p-3 dark:bg-secondary-900 md:col-span-4"},he={class:"mt-2"},ve={class:"label mb-1"},ye={class:"multiselect-single-label"},_e={class:"flex justify-between"},xe=t("span",{class:"text-lg"},"Size",-1),we={class:"col-span-full flex flex-col justify-end md:col-span-8"},ke=t("i",{class:"bx bxs-arrow-from-bottom text-xl"},null,-1),Se=[ke],je=t("i",{class:"bx bxs-arrow-from-top text-xl"},null,-1),Ce=[je],Oe=t("i",{class:"bx bxs-trash-alt"},null,-1),De=[Oe],Ae={class:"mt-4 flex justify-end"},Te={key:1},Fe=t("label",{class:"label mb-3 text-lg"},"Slogan",-1),Pe={class:"mb-4 mt-2 flex items-center gap-3"},ze=["disabled"],Me={key:0,class:"my-1.5 mr-px h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ne=t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),Re=t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1),$e=[Ne,Re],qe={key:1,class:"bx bx-refresh text-2xl"},Ie=t("span",null,"Regenerate",-1),Be=t("h5",{class:"mb-3 border-b border-secondary-300 pb-4 pt-2 dark:border-gray-700"},"Designs",-1),Le=t("p",{class:"mb-3 text-lg text-secondary-400"},"Frames",-1),Ve={class:"grid grid-cols-1 place-items-center gap-5 overflow-y-auto sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2"},Ee=["onClick"],Je={class:"h-full w-full object-cover",alt:"image"},Qe={__name:"DesignTab",props:["designs"],setup(j){const $=ie(),e=le();let C=u(null),p=u("Arial"),m=u(20),c=null,o=null;const O=u(!1),D=u(e.getOriginalMedia);G(()=>{c=new w.fabric.StaticCanvas,o=new w.fabric.Canvas(C.value,{preserveObjectStacking:!0,backgroundColor:"transparent",width:500,height:500}),o.on("selection:created",A),o.on("selection:updated",A),o.on("selection:cleared",W)}),K(()=>e.designEditor,()=>{e.designEditor&&I()});const k=(a="last")=>{var n,l;for(let s of e.dataObjects.objects)s.id==="placeholderImage"&&(s.src=e.getOriginalMedia??D.value??"/assets/img/about/about-bg-shape.png",s.crossOrigin="anonymous"),s.id==="placeholderLogo"&&(s.src=((l=(n=e.form)==null?void 0:n.brand)==null?void 0:l.logo)??"/assets/img/about/about-bg-shape.png",s.crossOrigin="anonymous"),s.id==="slogan"&&a=="initial"&&(s.text=e.form.slogan??"Slogan")},q=async(a,n)=>{var g,F;const l=e.getActivePlatformContent(),s=(g=e.selectedDesigns)==null?void 0:g.find(r=>r.platform===e.platformTab),b=r=>e.form.platforms.map(y=>y.platform===e.platformTab?{...r}:y);if(s){l.media=[];const r=e.selectedDesigns.filter(v=>v.platform!==s.platform);e.$patch({selectedDesigns:r,form:{platforms:b(l)}});return}if(e.getActivePlatformContent("media_type")!=="image"||((F=e.getActivePlatformContent("media"))==null?void 0:F.length)<1){S.danger("Select an image");return}if(e.getActivePlatformContent("media").length>1){S.danger("Multiple images not supported");return}const h={platform:e.platformTab,design:n};e.$patch({isDesignProcessing:!0,selectedDesigns:[...e.selectedDesigns,h],dataObjects:a}),await ae.post(route("api.publish.process_image"),{image:e.getActivePlatformContent("media")[0],type:e.platformSelectedMediaFrom}).then(r=>{D.value=r.data.image;const v={platform:e.platformTab,media:r.data.image},y=e.originalSelectedMedias.filter(Z=>Z.platform!==e.platformTab);e.$patch({originalSelectedMedias:[...y,v]})}).catch(r=>{S.danger(r.response.data)}),k("initial"),c.loadFromJSON(JSON.stringify(e.dataObjects),function(){c.renderAll(),l.media[0]=c.toDataURL({width:500,height:500}),setTimeout(()=>{e.$patch({isDesignProcessing:!1,form:{platforms:b(l)}})},2e3)})},I=()=>{B()},B=()=>{k(),o.loadFromJSON(JSON.stringify(e.dataObjects),function(){o.renderAll()})},A=()=>{const a=o.getActiveObject();O.value=a.type,a.isType("i-text")&&(m.value=a.fontSize),a.type},L=()=>{const a=new w.fabric.IText("Insert text",{left:20,top:20,fontSize:24,fontFamily:"Arial",fill:"#ffffff",fontWeight:"normal",underline:!1,textAlign:"center",textBackgroundColor:"transparent"});o.add(a),o.renderAll()},V=a=>{const n=new FileReader;n.onload=function(l){w.fabric.Image.fromURL(l.target.result,function(s){s.scale(.2).set({left:200,top:100}),o.add(s)})},n.readAsDataURL(a.target.files[0])},E=()=>{const a=o.getActiveObjects();a.length?confirm("Do you want to delete the selected items?")&&a.forEach(function(n){o.remove(n)}):o.remove(o.getActiveObject()),o.renderAll()},J=()=>{o.bringToFront(o.getActiveObject()),o.renderAll()},U=()=>{o.sendToBack(o.getActiveObject()),o.renderAll()},W=()=>{O.value=null},H=()=>{e.$patch({isDesignProcessing:!0,dataObjects:o.toJSON(["id"])}),k();const a=e.getActivePlatformContent();c.loadFromJSON(JSON.stringify(e.dataObjects),function(){c.renderAll(),a.media[0]=c.toDataURL({width:500,height:500});const n=e.form.platforms.map(l=>l.platform===e.platformTab?{...a}:l);setTimeout(()=>e.$patch({isDesignProcessing:!1,form:{platforms:n}}),3e3)})},T=()=>{o.getActiveObject().set({fontFamily:p.value,fontSize:m.value}),o.requestRenderAll()};return(a,n)=>{const l=Q("lazy");return d(),f(N,null,[_(t("div",ce,[t("div",de,[t("div",me,[ge,t("button",{type:"button",onClick:n[0]||(n[0]=s=>i(e).$patch({designEditor:!1}))},pe)]),t("div",ue,[t("div",be,[t("div",he,[t("label",ve,x(a.trans("Font Family")),1),Y(i(re),{onSelect:T,class:"multiselect-dark",modelValue:i(p),"onUpdate:modelValue":n[1]||(n[1]=s=>z(p)?p.value=s:p=s),mode:"single",options:i($).fontLists,searchable:!0,placeholder:"Select Fonts"},{singlelabel:P(({value:s})=>[t("div",ye,[t("span",{style:R({fontFamily:`${s.label}`})},x(s.label),5)])]),option:P(({option:s})=>[t("span",{style:R({fontFamily:`${s.label}`})},x(s.label),5)]),_:1},8,["modelValue","options"])]),t("div",_e,[xe,_(t("input",{"onUpdate:modelValue":n[2]||(n[2]=s=>z(m)?m.value=s:m=s),onInput:T,type:"text",class:"input w-20"},null,544),[[M,i(m)]])]),t("button",{onClick:L,class:"w-full rounded-md border bg-secondary-100 py-2 text-center shadow hover:bg-opacity-50 dark:border-secondary-600 dark:bg-secondary-700 dark:hover:bg-opacity-50"},x(a.trans("Insert text")),1),t("input",{onInput:V,accept:"image/*",type:"file",class:"input"},null,32)]),t("div",we,[t("div",{class:"mx-auto mb-2 flex max-w-max items-center gap-1 rounded-md bg-secondary-200 dark:bg-secondary-900"},[t("button",{onClick:J,class:"btn px-2 py-1 hover:bg-primary-800/60 hover:text-white"},Se),t("button",{onClick:U,class:"btn px-2 py-1 hover:bg-primary-800/60 hover:text-white"},Ce),t("button",{onClick:E,class:"btn p-2 hover:bg-primary-800/60 hover:text-white"},De)]),t("canvas",{ref_key:"canvasEl",ref:C,class:"ml-auto h-[500px] w-[500px] rounded border border-secondary-200 dark:border-secondary-700"},null,512)])]),t("div",Ae,[t("button",{onClick:H,class:"btn btn-primary"},[i(e).isDesignProcessing?(d(),ee(ne,{key:0,dotClass:"dot-white",class:"flex w-20 items-center justify-center"})):(d(),f("span",Te,"Re Render"))])])])],512),[[X,i(e).designEditor]]),Fe,_(t("input",{type:"text","onUpdate:modelValue":n[3]||(n[3]=s=>i(e).form.slogan=s),class:"input mb-2",placeholder:"Slogan"},null,512),[[M,i(e).form.slogan]]),t("div",Pe,[t("button",{disabled:i(e).loading.slogan,type:"button",onClick:n[4]||(n[4]=s=>i(e).generateContent("slogan")),class:"btn btn-soft-primary w-full"},[i(e).loading.slogan?(d(),f("svg",Me,$e)):(d(),f("i",qe)),Ie],8,ze)]),Be,Le,t("div",Ve,[j.designs.length>0?(d(!0),f(N,{key:0},te(j.designs,(s,b)=>{var h;return d(),f("button",{key:b,class:oe(["h-64 overflow-hidden rounded-lg border dark:border-gray-600",{"border-2 border-primary-500 dark:border-primary-500":(h=i(e).selectedDesigns)==null?void 0:h.find(g=>g.platform==i(e).platformTab&&g.design==s.id)}]),onClick:g=>q(s.canvas,s.id)},[_(t("img",Je,null,512),[[l,s.placeholder]])],10,Ee)}),128)):se("",!0)])],64)}}};export{Qe as default};

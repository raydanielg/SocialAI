import{s as f,a1 as d,T as h,O as r,q as o,a5 as n}from"./app-13978987.js";const{countWordsAndChars:u}=f(),p=d({id:"publishStore",state:()=>({form:h({}),tiktokOptions:{privacy_level:"",disable_comment:!1,disable_duet:!1,disable_stitch:!1},assetTabs:["uploads","ai","stock"],platforms:[],platformTab:"",publishAccounts:[],userPlatforms:[],newContent:{},publishingPlatform:null,publishingPlatformIdIndex:null,brandPostContentPlatform:{},platformSelectedMediaType:null,imageTab:"uploads",videoTab:"uploads",mainTab:"input",loading:{content:!1,slogan:!1,publish:!1,draft:!1},isDesignProcessing:!1,selectedDesignId:null,selectedDesigns:[],designEditor:!1,dataObjects:{},originalSelectedMedias:[]}),actions:{draftPost(){this.loading.draft=!0;let t=route("user.brand-posts.update",this.form.uuid),i={newBrandPost:{...this.form},status:"draft"};r.put(t,i,{onSuccess:s=>{var e;this.form.platforms=[...((e=s.props.content)==null?void 0:e.platforms)??[]]},onFinish:()=>{this.loading.draft=!1}})},schedulePost(){if(this.form.scheduled_at==null){o.warning("Please choose a schedule date and time");return}let t=route("user.brand-posts.update",this.form.uuid),i={newBrandPost:this.form,status:"schedule",user_platforms:this.publishAccounts,is_schedule:!0,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone};this.loading.publish=!0,r.put(t,i,{onFinish:()=>{this.loading.publish=!1}})},publishPost(){if(u(this.form.input).words>100){o.danger("Maximum words allowed is 100");return}if(this.publishAccounts.length==0){this.setTab("connect"),o.warning("Please choose at least one publisher account");return}this.publishingPlatformIdIndex=0,this.loading.publish=!0,this.dispatchPosts("save_and_publish")},dispatchPosts(t="save_and_publish"){let i=this.publishAccounts[this.publishingPlatformIdIndex];if(!i){this.finishPublishing();return}if(this.getPublishedPlatforms.find(s=>s.platform==i.platform))return this.publishNextPost();this.publishingPlatform=i,this.publishingPlatform.platform==="tiktok"&&(this.form.tiktokOptions=this.tiktokOptions),n.put(route("user.brand-posts.update",this.form.uuid),{newBrandPost:this.form,platform_id:this.publishingPlatform.id,status:t}).then(s=>{let e=s.data;this.form.platforms=this.form.platforms.map(a=>a.id===e.id?e:a)}).catch(s=>{var e;this.form.platforms=this.form.platforms.map(a=>a.id===this.publishingPlatform.id?{...a,status:"failed"}:a),o.danger(((e=Object.values(s))==null?void 0:e[0])??"Something went wrong!")}).finally(()=>{this.publishingPlatformIdIndex<this.publishAccounts.length-1?this.publishNextPost():this.finishPublishing()})},publishNextPost(){this.publishingPlatformIdIndex++,setTimeout(()=>this.dispatchPosts(),100)},finishPublishing(){this.publishingPlatformIdIndex=null,this.publishingPlatform=null,this.loading.publish=!1},setOriginalContent(t){var i,s;this.form={...t},this.brandPostContentPlatform=(i=this.form.platforms)==null?void 0:i.find(e=>e.platform==this.platformTab),this.brandPostContentPlatform||(this.brandPostContentPlatform={content:"",platform:this.platformTab},this.form.platforms=[...this.form.platforms,this.brandPostContentPlatform]),this.platformSelectedMediaType=t.media_type??"",this.platformSelectedMedia=((s=this.findPostPlatformByName(this.platformTab))==null?void 0:s.media)??[]},setTab(t){this.mainTab=t},setPlatformTab(t){const i=this.platformTab;this.platformTab=t;const s=this.brandPostContentPlatform;this.brandPostContentPlatform=this.form.platforms.find(e=>e.platform===t),this.brandPostContentPlatform||(this.brandPostContentPlatform={content:"",platform:t},this.form.platforms=[...this.form.platforms,this.brandPostContentPlatform]),this.form.platforms=this.form.platforms.map(e=>e.platform===i?{...s}:e)},setImagesTab(t){this.imageTab=t},setVideosTab(t){this.videoTab=t},generateContent(t){const i={content:"content",slogan:"slogan"};this.loading[i[t]]=!0,n.post(route("user.generate-content",{type:t,brand_id:this.form.brand_id,post_id:this.form.id,description:this.form.input,platform:this.platformTab})).then(s=>{setTimeout(()=>{t==="slogan"&&(this.form[i[t]]=s.data),t==="content"&&(this.brandPostContentPlatform.content=s.data),this.draftPost()},3e3)}).catch(s=>{o.danger(s.response.data)}).finally(()=>{setTimeout(()=>this.loading[i[t]]=!1,3e3)})},setPlatformMedia(t,i,s="image"){var a;let e=this.getActivePlatformContent();e.media_type!=s&&(this.platformSelectedMedia=[]),this.platformSelectedMedia.includes(t)?this.platformSelectedMedia=this.platformSelectedMedia.filter(l=>l!=t):s=="video"?(this.platformSelectedMedia=[],this.platformSelectedMedia.push(t)):s=="image"&&this.platformSelectedMedia.push(t),this.brandPostContentPlatform.media_type=s,this.brandPostContentPlatform.media=this.platformSelectedMedia,e.media_type=this.platformSelectedMedia.length>0?s:null,e.media=this.platformSelectedMedia,this.platformSelectedMediaFrom=i,this.platformSelectedMediaType=((a=this.platformSelectedMedia)==null?void 0:a.length)>0?s:null},togglePublishAccount(t,i=!1){if(this.loading.publish)return;let s=this.findPostPlatformByName(t.platform).status??null;if(["published","scheduled"].includes(s))return o.danger(`The ${t.platform} platform is already ${s}. Please choose from another platform`);if(this.findPublishAccount(t.id)){if(this.publishAccounts.length===1&&!i)return o.warning("Can't remove item, at least one item is required");this.publishAccounts=this.publishAccounts.filter(e=>e.id!=t.id)}else{this.publishAccounts=this.publishAccounts.filter(a=>a.platform!=t.platform),this.publishAccounts.push(t);let e=this.findPublishAccountByName("tiktok")??null;if(e){let a=e.meta??[];a.length>0&&(this.tiktokOptions.disable_comment=(a==null?void 0:a.comment_disabled)??!1,this.tiktokOptions.disable_duet=(a==null?void 0:a.duet_disabled)??!1,this.tiktokOptions.disable_stitch=(a==null?void 0:a.stitch_disabled)??!1)}}}},getters:{findPublishAccount:t=>i=>t.publishAccounts.find(s=>s.id==i),findPublishAccountByName:t=>i=>t.publishAccounts.find(s=>s.platform==i),findPostPlatform:t=>i=>{var s;return((s=t.form)==null?void 0:s.platforms.find(e=>e.id==i))??null},findPostPlatformByUserPlatformId:t=>i=>{var s;return((s=t.form)==null?void 0:s.platforms.find(e=>e.user_platform_id==i))??null},findPostPlatformByName:t=>i=>{var s,e;return((e=(s=t.form)==null?void 0:s.platforms)==null?void 0:e.find(a=>a.platform==i))??null},checkUserPlatformIsAvailable:t=>i=>{var s,e,a;return["draft","failed"].includes((a=(e=(s=t.form)==null?void 0:s.platforms)==null?void 0:e.find(l=>l.platform==i))==null?void 0:a.status)},getPublishedPlatforms:t=>{var i,s;return((s=(i=t.form)==null?void 0:i.platforms)==null?void 0:s.filter(e=>e.status=="published"))??[]},getTabState:t=>i=>t.mainTab==i,getPlatformTabState:t=>i=>t.platformTab==i,getImagesTabState:t=>i=>t.imageTab==i,getVideosTabState:t=>i=>t.videoTab==i,getActivePlatformContent:t=>(i=null)=>{var e,a;let s=((a=(e=t.form)==null?void 0:e.platforms)==null?void 0:a.find(l=>l.platform==t.platformTab))||{};return i?s[i]:s},getOriginalMedia:t=>{var i,s;return((s=(i=t.originalSelectedMedias)==null?void 0:i.find(e=>e.platform===t.platformTab))==null?void 0:s.media)??[]},tiktokUserOptions:t=>{var i;return((i=t.findPublishAccountByName("tiktok"))==null?void 0:i.meta)??{}}}});export{p as u};
